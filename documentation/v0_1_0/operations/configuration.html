<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Project Flotta</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="this is meta description">
    
  
  
  <!-- ** Plugins Needed for the Project ** -->
  
  <link rel="stylesheet" href="/assets/plugins/bootstrap/bootstrap.min.css">
  
  <link rel="stylesheet" href="/assets/plugins/themify-icons/themify-icons.css">
  
  <link rel="stylesheet" href="/assets/plugins/slick/slick.css">
  

  <link href="/assets/scss/syntax_monokai.css" rel="stylesheet">
  <!-- Main Stylesheet -->
  <link href="/assets/scss/style.css" rel="stylesheet">

  <!--Favicon-->
  <link rel="shortcut icon" href="/assets/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="/assets/images/flotta-logo-stacked.ico " type="image/x-icon">

  <!-- google analytics -->
  

</head>


<body>

  <header class="navigation fixed-top nav-bg">
  <nav class="navbar navbar-expand-lg navbar-dark">
    <a class="navbar-brand font-tertiary h3" href="/">
      
        <img src="/assets/images/flotta-logo.png" alt="Project Flotta" style="height: 60px;">
        
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
      aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse text-center" id="navigation">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item active">
          <a class="nav-link" href="/">Home</a>
        </li>
        
          <li class="nav-item ">
            <a class="nav-link" href="/blog.html">Blog</a>
          </li>
        
          <li class="nav-item ">
            <a class="nav-link" href="/documentation/v0_1_0/intro/overview.html">Documentation</a>
          </li>
        
      </ul>
    </div>
  </nav>
</header>


  <section class="section skip_top">
  <div class="container">
    <div class="row">
      <div class="col-lg-4">
        
        
        <ul class="list-group list-group-collapse border-0">
          
            <li class="list-group-item border-0">
              <h5>
                
                  Intro
                
              </h5>
              
                <ul class="list-group border-0">
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/intro/overview.html">What is flotta</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/intro/usecases.html">Use cases</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/intro/vs.html">Flotta vs others</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/intro/concepts.html">Concepts</a> </li>
                  
                </ul>
              
            </li>
          
            <li class="list-group-item border-0">
              <h5>
                
                  Getting started
                
              </h5>
              
                <ul class="list-group border-0">
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/gsg/minikube.html">Minikube</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/gsg/kind.html">Kind</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/gsg/ocp.html">OCP</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/gsg/running_workloads.html">Running workloads</a> </li>
                  
                </ul>
              
            </li>
          
            <li class="list-group-item border-0">
              <h5>
                
                  Operations
                
              </h5>
              
                <ul class="list-group border-0">
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/operations/requirements.html">System Requirements</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/operations/deployment_options.html">Deployment options</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/operations/configuration.html">Configuration</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/operations/observability.html">Observability</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/operations/data_upload.html">Data upload</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/operations/troubleshooting.html">Troubleshooting</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/operations/api.html">API reference</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/operations/crd.html">CRD reference</a> </li>
                  
                </ul>
              
            </li>
          
            <li class="list-group-item border-0">
              <h5>
                
                  For developers
                
              </h5>
              
                <ul class="list-group border-0">
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/dev/installation.html">Manual installation & tips</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/dev/guide.html">Development Guide</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/dev/profiling.html">Profiling</a> </li>
                  
                </ul>
              
            </li>
          
        </ul>
        <p>Documentation for version: <b>v0.1.0</b></p>
        <b>Other versions</b>
        <ul class="list-group list-group-collapse border-0">
        
          
          
            <li class="list-group-item border-0">

              
              <a href="/documentation/latest/intro/overview.html"> latest</a>
            </li>
        
          
          
            <li class="list-group-item border-0">

              
              <a href="/documentation/v0_1_0/intro/overview.html"> v0.1.0</a>
            </li>
        
        </ul>
      </div>

      <div class="col-lg-8">
        <div class="documentation content">
          
          

          <h1 id="operator-config">Operator Config</h1>

<h2 id="deploying-workloads">Deploying workloads</h2>

<p>Workload can be deployed to devices <strong>after</strong> they are registered with the
cluster. <code class="language-plaintext highlighter-rouge">EdgeWorkload</code> can be deployed only on edge devices in the same
namespace.</p>

<h3 id="deploying-by-device-id">Deploying by device ID</h3>

<hr />
<p><strong>Note</strong></p>

<p>When both methods are used in one <code class="language-plaintext highlighter-rouge">EdgeWorkload</code>, this one takes precedence over the selector-based one.</p>

<hr />

<p><code class="language-plaintext highlighter-rouge">EdgeWorkload</code> can be deployed on one chosen device by specifying its name in <code class="language-plaintext highlighter-rouge">spec.device</code> property.</p>

<p>For example, for <code class="language-plaintext highlighter-rouge">EdgeDevice</code> <code class="language-plaintext highlighter-rouge">242e48d0-286b-4170-9b97-95502066e6ae</code>, following property should be set in <code class="language-plaintext highlighter-rouge">EdgeWorkload</code> yaml:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spec</span><span class="pi">:</span>
  <span class="s">...</span>
  <span class="s">device</span><span class="err">:</span> <span class="s">242e48d0-286b-4170-9b97-95502066e6ae</span>
  <span class="s">...</span>
</code></pre></div></div>

<h3 id="deploying-with-selector">Deploying with selector</h3>

<p><code class="language-plaintext highlighter-rouge">EdgeWorkload</code> can be installed on multiple devices using label selectors.</p>

<p>To deploy your workload using this method:</p>

<p>1) Label chosen <code class="language-plaintext highlighter-rouge">EdgeDevice</code> objects;</p>

<p>For example:</p>

<p><code class="language-plaintext highlighter-rouge">oc label edgedevice 242e48d0-286b-4170-9b97-95502066e6ae dc=emea</code></p>

<p>2) Select <code class="language-plaintext highlighter-rouge">dc=emea</code> label in the <code class="language-plaintext highlighter-rouge">EdgeWorkload</code> specification:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spec</span><span class="pi">:</span>
 <span class="na">deviceSelector</span><span class="pi">:</span>
   <span class="na">matchLabels</span><span class="pi">:</span>
     <span class="na">dc</span><span class="pi">:</span> <span class="s">emea</span>
</code></pre></div></div>
<p>or</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spec</span><span class="pi">:</span>
 <span class="na">deviceSelector</span><span class="pi">:</span>
   <span class="na">matchExpressions</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">dc</span>
       <span class="na">operator</span><span class="pi">:</span> <span class="s">In</span>
       <span class="na">values</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">emea</span><span class="pi">]</span>
</code></pre></div></div>

<p>The second approach can be used for matching multiple values of one label. For example:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spec</span><span class="pi">:</span>
 <span class="na">deviceSelector</span><span class="pi">:</span>
   <span class="na">matchExpressions</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">dc</span>
       <span class="na">operator</span><span class="pi">:</span> <span class="s">In</span>
       <span class="na">values</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">emea</span><span class="pi">,</span> <span class="nv">apac</span><span class="pi">]</span>
</code></pre></div></div>

<p>3) Create the <code class="language-plaintext highlighter-rouge">EdgeWorkload</code> in the cluster:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-f</span> your-workload.yaml
</code></pre></div></div>

<h3 id="inspecting-workload-status">Inspecting workload status</h3>

<p>To check statuses of all workloads deployed to an edge device:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get edgedevice &lt;edge device name&gt; <span class="nt">-ojsonpath</span><span class="o">=</span><span class="s2">"{range .status.workloads[*]}{.name}{':</span><span class="se">\t</span><span class="s2">'}{.phase}{'</span><span class="se">\n</span><span class="s2">'}{end}"</span>
</code></pre></div></div>

<p>To list all devices having chosen workload deployed:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oc get edgedevice <span class="nt">-l</span> workload/&lt;workload-name&gt;<span class="o">=</span><span class="s2">"true"</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">EdgeDevice</code> is labeled with <code class="language-plaintext highlighter-rouge">workload/&lt;workload-name&gt;="true"</code> when <code class="language-plaintext highlighter-rouge">EdgeWorkload</code> is added to it.</p>

<h2 id="container-image-registries-credentials">Container Image Registries Credentials</h2>

<p>Container images used by <code class="language-plaintext highlighter-rouge">EdgeWorkloads</code> may be hosted in private, protected
repositories requiring clients to present correct credentials. Users can provide
said credentials to Flotta operator as a <code class="language-plaintext highlighter-rouge">Secret</code> referred to by an
<code class="language-plaintext highlighter-rouge">EdgeWorkload</code>.</p>

<p>Secret should contain correct docker auth file under the <code class="language-plaintext highlighter-rouge">.dockerconfigjson</code> key:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pull-secret</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">kubernetes.io/dockerconfigjson</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">.dockerconfigjson</span><span class="pi">:</span> <span class="s">ewoJImF1dGhzIjogewoJCSJxdWF5LmlvIjogewoJCQkiYXV0aCI6ICJabTl2SUdKaGNpQm1iMjhnWW1GeUNnPT0iCgkJfQoJfQp9Cg==</span>
</code></pre></div></div>

<p>where <code class="language-plaintext highlighter-rouge">.dockerconfigjson</code> is a base64 encoded Docker auth file JSON:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"auths"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"quay.io"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"auth"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Zm9vIGJhciBmb28gYmFyCg=="</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The above JSON can be taken from file created by running <code class="language-plaintext highlighter-rouge">podman login</code>, <code class="language-plaintext highlighter-rouge">docker
login</code> or similar.</p>

<p>Secret created above must be placed in the same namespace as <code class="language-plaintext highlighter-rouge">EdgeWorkload</code>
using it.</p>

<p>Reference to the above <code class="language-plaintext highlighter-rouge">Secret</code> in an <code class="language-plaintext highlighter-rouge">EdgeWorkload</code> spec:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spec</span><span class="pi">:</span>
  <span class="na">imageRegistries</span><span class="pi">:</span>
    <span class="na">secretRef</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">pull-secret</span>
</code></pre></div></div>

<h2 id="podman-auto-update">Podman auto-update</h2>

<p>Auto update containers according to their auto-update policy.</p>

<p>Auto-update looks up containers with a specified <code class="language-plaintext highlighter-rouge">io.containers.autoupdate</code>
label. This label is set by the <code class="language-plaintext highlighter-rouge">flotta-operator</code>. Flotta-operator looks up
labels on <code class="language-plaintext highlighter-rouge">EdgeWorkloads</code> CR prefixed by <code class="language-plaintext highlighter-rouge">podman/</code> string. If such label is
found it’s propageted to the podman pod and containers.</p>

<p>If  the  label  is  present  and set to registry, Podman reaches out to the
corresponding registry to check if the image has been updated. The label image
is an alternative to registry maintained for backwards compatibility.  An image
is considered updated if the digest in the local storage is different than the
one of the remote image.  If an image must be  updated,  Podman  pulls  it  down
and restarts the systemd unit executing the container.</p>

<p>If <code class="language-plaintext highlighter-rouge">ImageRegistries.AuthFileSecret</code> is defined, Podman reaches out to the
corresponding authfile when pulling images.</p>

<p>Edgedevice start the <code class="language-plaintext highlighter-rouge">podman-auto-update.timer</code> which is responsible for
executing the <code class="language-plaintext highlighter-rouge">podman-auto-update.service</code>. This unit is triggered daily.</p>

<p>To create a Edgeworkload with auto-update feature enabled define following
label:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">management.project-flotta.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">EdgeWorkload</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">podman/io.containers.autoupdate</span><span class="pi">:</span> <span class="s">registry</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">deviceSelector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">device</span><span class="pi">:</span> <span class="s">local</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">pod</span>
  <span class="na">pod</span><span class="pi">:</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">quay.io/bitnami/nginx:1.20</span>
</code></pre></div></div>

<h2 id="logging">Logging</h2>

<p>To change the verbosity of the logger, the user can update the value of the <code class="language-plaintext highlighter-rouge">LOG_LEVEL</code> field.
Admitted values are: 	<code class="language-plaintext highlighter-rouge">debug</code>, <code class="language-plaintext highlighter-rouge">info</code>, <code class="language-plaintext highlighter-rouge">warn</code>, <code class="language-plaintext highlighter-rouge">error</code>, <code class="language-plaintext highlighter-rouge">dpanic</code>, <code class="language-plaintext highlighter-rouge">panic</code>, and <code class="language-plaintext highlighter-rouge">fatal</code>.
Refer to <a href="https://github.com/uber-go/zap/blob/v1.15.0/zapcore/level.go#L32">zapcore docs</a> for details on each log level.</p>

<p>For example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl patch cm <span class="nt">-n</span> flotta flotta-operator-manager-config <span class="se">\</span>
  <span class="nt">--type</span> merge <span class="se">\</span>
  <span class="nt">--patch</span> <span class="s1">'{"data":{"LOG_LEVEL": "debug"}}'</span>
</code></pre></div></div>

<p>In case of:</p>
<ul>
  <li><em>Inside the cluster</em> run, the pod will be automatically restarted.</li>
  <li><em>Outside the cluster</em> run, the user must set the <code class="language-plaintext highlighter-rouge">LOG_LEVEL</code> field and manually restart the operator.</li>
</ul>

<h1 id="device">Device</h1>

        </div>
      </div>
    </div>
  </div>
</section>


  <!-- footer -->
<footer class="bg-dark footer-section">
  <div class="section">
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <h5 class="text-light">Email</h5>
          <p class="text-white paragraph-lg font-secondary">flotta@redhat.com</p>
        </div>
        <div class="col-md-4">
          <h5 class="text-light">Supported by</h5>
          <h5><a href="http://www.redhat.com"><img id="sponsorship" class="footerLogo" src="/assets/images/Logo-Red_Hat-Supported_By-A-Reverse-RGB.svg"></a>.</h5>
        </div>
        <!-- <div class="col-md-4"> -->
        <!--   <h5 class="text-light">Address</h5> -->
        <!--   <p class="text-white paragraph-lg font-secondary"></p> -->
        <!-- </div> -->
      </div>
    </div>
  </div>
  <div class="border-top text-center border-dark py-5">
    <p class="mb-0 text-light"><p>Copyright © 2020 Designed by <a href="https://themefisher.com">Themefisher</a> &amp; Developed by <a href="https://getjekyllthemes.com">Getjekyllthemes</a></p>
</p>
  </div>
</footer>
<!-- /footer -->


<!-- JS Plugins -->

<script src="/assets/plugins/jQuery/jquery.min.js"></script>

<script src="/assets/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/assets/plugins/shuffle/shuffle.min.js"></script>

<script src="/assets/plugins/slick/slick.min.js"></script>


<!-- Main Script -->
<script src="/assets/js/script.js"></script>


</body>

</html>
