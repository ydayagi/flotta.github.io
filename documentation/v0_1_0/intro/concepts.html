<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Flotta concepts</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="this is meta description">
    
  
  
  <!-- ** Plugins Needed for the Project ** -->
  
  <link rel="stylesheet" href="/assets/plugins/bootstrap/bootstrap.min.css">
  
  <link rel="stylesheet" href="/assets/plugins/themify-icons/themify-icons.css">
  
  <link rel="stylesheet" href="/assets/plugins/slick/slick.css">
  

  <link href="/assets/scss/syntax_monokai.css" rel="stylesheet">
  <!-- Main Stylesheet -->
  <link href="/assets/scss/style.css" rel="stylesheet">

  <!--Favicon-->
  <link rel="shortcut icon" href="/assets/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="/assets/images/flotta-logo-stacked.ico " type="image/x-icon">

  <!-- google analytics -->
  

</head>


<body>

  <header class="navigation fixed-top nav-bg">
  <nav class="navbar navbar-expand-lg navbar-dark">
    <a class="navbar-brand font-tertiary h3" href="/">
      
        <img src="/assets/images/flotta-logo.png" alt="Project Flotta" style="height: 60px;">
        
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
      aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse text-center" id="navigation">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item active">
          <a class="nav-link" href="/">Home</a>
        </li>
        
          <li class="nav-item ">
            <a class="nav-link" href="/blog.html">Blog</a>
          </li>
        
          <li class="nav-item ">
            <a class="nav-link" href="/documentation/v0_1_0/intro/overview.html">Documentation</a>
          </li>
        
      </ul>
    </div>
  </nav>
</header>


  <section class="section skip_top">
  <div class="container">
    <div class="row">
      <div class="col-lg-4">
        
        
        <ul class="list-group list-group-collapse border-0">
          
            <li class="list-group-item border-0">
              <h5>
                
                  Intro
                
              </h5>
              
                <ul class="list-group border-0">
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/intro/overview.html">What is flotta</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/intro/usecases.html">Use cases</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/intro/vs.html">Flotta vs others</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/intro/concepts.html">Concepts</a> </li>
                  
                </ul>
              
            </li>
          
            <li class="list-group-item border-0">
              <h5>
                
                  Getting started
                
              </h5>
              
                <ul class="list-group border-0">
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/gsg/minikube.html">Minikube</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/gsg/kind.html">Kind</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/gsg/ocp.html">OCP</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/gsg/running_workloads.html">Running workloads</a> </li>
                  
                </ul>
              
            </li>
          
            <li class="list-group-item border-0">
              <h5>
                
                  Operations
                
              </h5>
              
                <ul class="list-group border-0">
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/operations/requirements.html">System Requirements</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/operations/deployment_options.html">Deployment options</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/operations/configuration.html">Configuration</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/operations/observability.html">Observability</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/operations/data_upload.html">Data upload</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/operations/troubleshooting.html">Troubleshooting</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/operations/api.html">API reference</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/operations/crd.html">CRD reference</a> </li>
                  
                </ul>
              
            </li>
          
            <li class="list-group-item border-0">
              <h5>
                
                  For developers
                
              </h5>
              
                <ul class="list-group border-0">
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/dev/installation.html">Manual installation & tips</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/dev/guide.html">Development Guide</a> </li>
                  
                    
                    <li class="list-group-item border-0"> <a href="/documentation/v0_1_0/dev/profiling.html">Profiling</a> </li>
                  
                </ul>
              
            </li>
          
        </ul>
        <p>Documentation for version: <b>v0.1.0</b></p>
        <b>Other versions</b>
        <ul class="list-group list-group-collapse border-0">
        
          
          
            <li class="list-group-item border-0">

              
              <a href="/documentation/latest/intro/overview.html"> latest</a>
            </li>
        
          
          
            <li class="list-group-item border-0">

              
              <a href="/documentation/v0_1_0/intro/overview.html"> v0.1.0</a>
            </li>
        
        </ul>
      </div>

      <div class="col-lg-8">
        <div class="documentation content">
          
            <!-- Some cases we don't want to show the title -->
            <h1 class="font-tertiary mb-5">Flotta concepts</h1>
          
          

          <p>The concepts chapter provides an overview of all aspects of Flotta. See the
getting started guides section if you are looking for an entry point
introduction to Flotta.</p>

<h2 id="components-overview">Components overview</h2>

<h2 id="operator">Operator</h2>

<p>The operator is responsible for handling all Custom Resources definitions from
project-flotta. All the resources that the operator manages can be found on CRD
spec or using the following command:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl api-resources <span class="nt">--api-group</span><span class="o">=</span><span class="s2">"management.project-flotta.io"</span>
</code></pre></div></div>

<p>By default, all CRDs are created/updated or by the operator or by any Kubernetes
user. Edge devices are not capable of dealing with Kubernetes objects.</p>

<h2 id="flotta-edge-api">Flotta Edge API</h2>

<p>By default, all Edgedevices connect to the Flotta Edge API, where they can
retrieve the config and push information. This API is defined
<a href="/documentation/v0_1_0/operations/api.html">here</a></p>

<p>Connectivity beetween the EdgeDevice to the API is using a Mutual TLS
connection, where we have two kinds of certificates.</p>

<ul>
  <li><strong>Register certificate</strong>: Is the certificate that the Edge Admin or factory
admin injects for the first time in the edge device. This device can only make
a registration Request to the Flotta Edge API.</li>
  <li><strong>User certificate</strong>: Is the certificate that it’s only valid for the specific
device. This certificate uses a key that shouldn’t leave the device, so the
API signs the certificate with the User Pub Key. At the same time, the short
lived cert, and Flotta operator managed to handle cert expiration.</li>
</ul>

<p>Communication from Edgedevice to the API is like this:</p>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.0.1/mermaid.min.js"></script>
<div class="mermaid">
sequenceDiagram
autonumber
participant Agent as Device Agent
participant YGGD as Yggdrasil
participant API as Flotta Edge API

rect rgb(226, 232, 238)
  Agent -&gt;&gt; YGGD: Register (GRPC+Unixsocket)
  YGGD -&gt;&gt; Agent: 200 OK
  Agent -&gt;&gt; YGGD: Send with enrolment directive
  YGGD -&gt;&gt; API: Data message with enrolment directive
  API -&gt;&gt; YGGD: 208 OK device-exists
  YGGD -&gt;&gt; Agent: 208 OK device exists
  Agent -&gt;&gt; YGGD: Send with registration directive
  YGGD -&gt;&gt; API: Data message with registration directive
  API -&gt;&gt; YGGD: 200 OK with signed certificate
  YGGD -&gt;&gt; Agent: 200 OK with signed certificate.
  Note over YGGD, Agent: New client certificate writen
end

rect rgb(233, 237, 202)
  loop Heartbeat
    Agent --&gt;&gt; YGGD: Heartbeat
    YGGD--&gt;&gt; API: Heartbeat
    API --&gt;&gt; YGGD: 200 OK
    YGGD--&gt;&gt; Agent: 200 OK
  end
end
</div>

<ol>
  <li>Flotta device-agent(Agent) register to Yggdrasil using Unixsocket and GRPC
connection</li>
  <li>Yggdrasil allows device-worker to register in the platform.</li>
  <li>Agent needs to know if can enrol in the system, so for that send a enrolment
directive.</li>
  <li>Yggdrasil forward that message to the configured transport to the Flotta Edge API.</li>
  <li>If device is already approved, Flotta Edge API will return back 208 status code to
Yggdrasil.</li>
  <li>Yggdrasil sends to the device agent the response.</li>
  <li>Agent needs now to register to the API, and for that sends a data-message with
the registration directive that includes a Certificate Signed Request(CSR).</li>
  <li>Yggdrasil forward that message in the configured transport to the Flotta Edge API</li>
  <li>If registration is successful, it will return a signed certificate based on
the CSR</li>
  <li>Yggdrasil sends to the agent the response. Agent rewrite the client certs to
   create new connections with the device certificates.</li>
  <li>-14 Each minute, Agent sends heartbeat data to the operator, if the operator
returns 200 OK nothing happens, if returns 401 for the certificate expired the
registration process will be started again.</li>
</ol>

<h2 id="edgedevice">EdgeDevice</h2>

<p>An Edgedevice can be multiple things, from a tiny RPI Zero to a big X86 server.
For flotta, an Edgedevie is an Operating system where device-agent and Yggdrasil
are running, and some container workloads can be run by this daemon.</p>

<p>The communication from the edgedevice to the Kubernetes server is not required,
so all communication is to the Flotta Edge API. At the same time, there are
no things like CNI, CSI interfaces for getting it lightweight.</p>

<p>What project-flotta focused is that edgedevices can have one or multiple specs:</p>

<ul>
  <li>Networks can be flaky, like a satellite, NB-IoT or Lorawan.</li>
  <li>Power consumption is a high priority; these devices can run on batteries.</li>
  <li>Devices can be turned off for a long period.</li>
  <li>Devices are insecure by default.</li>
  <li>Communication should always be encrypted.</li>
</ul>

<p>The EdgeDevice is a CRD that it’s defined <a href="../operations/crd.html#edgedevice">here</a></p>

<h3 id="yggdrasil">Yggdrasil</h3>

<p>Is a client daemon that establishes a receiving queue for instructions to be
sent to the system via a broker. For us, the broker is HTTP, and it’s the Flotta
Edge API.</p>

<h3 id="device-agent">Device Agent</h3>

<p>Device Agent is a worker for Yggdrasil, and it’s the agent that deploys all
podman, systemd, logs for all workloads, and deals with the Commmunication to
the Flotta Edge API.</p>

<h2 id="edgedevice-signed-request">EdgeDevice Signed Request</h2>

<p>EdgeDevice Signed Request is a specific <a href="../operations/crd.html#edgedevicesignedrequest">CRD
type</a>. When AUTO_APPROVAL is set
to false, when device tries to register, but before it, and Edge Administrator
needs to approve where the device will land and what kind of configuration it’ll
have.</p>

<h2 id="devicesets">DeviceSets</h2>

<p>When a platform has thousands of different devices, a configuration group is
needed to have similar configurations across different devices. A <a href="../operations/crd.html#edgedeviceset">Device
Set</a> is one kind of CRD that allows users
to define this configuration.</p>

<p>Example:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">management.project-flotta.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">EdgeDeviceSet</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">set-1</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">heartbeat</span><span class="pi">:</span>
    <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">5</span>
  <span class="na">metrics</span><span class="pi">:</span>
    <span class="na">system</span><span class="pi">:</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="m">600</span>
  <span class="na">osInformation</span><span class="pi">:</span>
    <span class="na">automaticallyUpgrade</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<h2 id="edgeworkload">EdgeWorkload</h2>

<p>When a user wants to run a workload on a edgedevice, we use the <a href="../operations/crd.html#edgeworkload">CRD
Edgeworkload</a>. With this deployment option,
you can run containers on any edgedevice.</p>

<p>EdgeWorkload has the same configuration as the Pod Specification, plus some
other entries that are specific to Flotta project. This is an example workload
manifest.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">management.project-flotta.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">EdgeWorkload</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">x86-logs</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">ny</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">deviceSelector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">device.cpu-architecture</span><span class="pi">:</span> <span class="s">x86_64</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">pod</span>
  <span class="na">pod</span><span class="pi">:</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">random-server</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">quay.io/project-flotta/nginx:1.21.6</span>
</code></pre></div></div>

        </div>
      </div>
    </div>
  </div>
</section>


  <!-- footer -->
<footer class="bg-dark footer-section">
  <div class="section">
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <h5 class="text-light">Email</h5>
          <p class="text-white paragraph-lg font-secondary">flotta@redhat.com</p>
        </div>
        <div class="col-md-4">
          <h5 class="text-light">Supported by</h5>
          <h5><a href="http://www.redhat.com"><img id="sponsorship" class="footerLogo" src="/assets/images/Logo-Red_Hat-Supported_By-A-Reverse-RGB.svg"></a>.</h5>
        </div>
        <!-- <div class="col-md-4"> -->
        <!--   <h5 class="text-light">Address</h5> -->
        <!--   <p class="text-white paragraph-lg font-secondary"></p> -->
        <!-- </div> -->
      </div>
    </div>
  </div>
  <div class="border-top text-center border-dark py-5">
    <p class="mb-0 text-light"><p>Copyright © 2020 Designed by <a href="https://themefisher.com">Themefisher</a> &amp; Developed by <a href="https://getjekyllthemes.com">Getjekyllthemes</a></p>
</p>
  </div>
</footer>
<!-- /footer -->


<!-- JS Plugins -->

<script src="/assets/plugins/jQuery/jquery.min.js"></script>

<script src="/assets/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/assets/plugins/shuffle/shuffle.min.js"></script>

<script src="/assets/plugins/slick/slick.min.js"></script>


<!-- Main Script -->
<script src="/assets/js/script.js"></script>


</body>

</html>
